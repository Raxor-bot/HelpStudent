<!DOCTYPE html>
<html lang="en">
<head>

    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.png"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">


    <title>HelpStudent</title>
    <!--  <link th:href="@{/styles/css/main.css}" rel="stylesheet">-->
    <!--  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">-->

</head>
<body>

<div id="app" onload="getStudent">
    <v-app class="grey lighten-4">

        <nav> <!-- Kopfzeile der Webseite -->
            <v-app-bar app flat color="grey lighten-4">
                <v-app-bar-nav-icon class="text-uppercase grey--text" @click="navdraw = !navdraw"></v-app-bar-nav-icon>

                <v-toolbar-title class="text-uppercase grey--text grey lighten-4">
                    <span class="font-weight-light">Help</span>
                    <span>Students</span>
                </v-toolbar-title>
                <v-spacer></v-spacer>
                <v-btn depressed  class="grey--text">
                    <span>Ausloggen</span>
                    <v-icon right>mdi-exit-to-app</v-icon>
                </v-btn>
            </v-app-bar>

            <!-- Ausfahrbare Navbar an der linken Seite-->
            <v-navigation-drawer
                    app
                    v-model="navdraw">
                <template v-slot:prepend>
                    <v-list-item two-line>

                        <!-- Profilinfos Navbar -->
                        <v-list-item-avatar>
                            <img src="https://randomuser.me/api/portraits/lego/6.jpg">
                        </v-list-item-avatar>
                        <v-list-item-content>
                            <v-list-item-title v-if="student != null"> {{student.svorname}} {{student.sname}} </v-list-item-title>
                            <v-list-item-subtitle>Angemeldet</v-list-item-subtitle>
                        </v-list-item-content>
                    </v-list-item>
                </template>

                <!-- Navbar Menüpunkte-->
                <v-list dense nav>
                    <v-list-item
                            v-for="item in items"
                            :key="item.title"
                            link
                            @click="openUrl(item.url, '_self')">
                        <v-list-item-icon>
                            <v-icon>{{item.icon}}</v-icon>
                        </v-list-item-icon>
                        <v-list-item-content>
                            <v-list-item-title>{{item.title}}</v-list-item-title>
                        </v-list-item-content>
                    </v-list-item>
                </v-list>
            </v-navigation-drawer>
        </nav>

        <!--Start Hauptcontent Profil  -->
        <v-main >

            <!-- Blauer Container-->
            <v-container fluid >
                <v-row>
                    <v-col cols="12" align-self="stretch">
                        <v-card height="250" color="#286BF9">
                            <v-avatar
                                    class="mt-10 mx-16"
                                    size="150"
                                    v-show="!editMode">
                                <img
                                        src="https://randomuser.me/api/portraits/lego/6.jpg"
                                        alt="Juan">
                            </v-avatar>

                            <v-avatar
                                    class="mt-10 mx-16"
                                    v-show="editMode"
                                    color="grey lighten-3"
                                    size="150">
                                <v-btn
                                        @click="$refs.imginput.click()"
                                        icon
                                        v-show="editMode"
                                        size="100"
                                >
                                    <v-icon
                                            size="100">mdi-pencil</v-icon>
                                </v-btn>
                            </v-avatar>
                            <input
                                    type="file"
                                    ref="imginput"
                                    v-show="false"
                                    :rules="rules"
                                    accept="image/png, image/jpeg"
                                    @change="onChange($event)"
                                    @remove="onRemove()">

                            <div class="mt-n16 mb-16 mx-16 white--text">
                                <p class="font-weight-black text-center mt-n16 mx-auto " v-if="student != null">{{student.svorname}} {{student.sname}}</p>
                                <p class="text-center"></p>

                                <v-chip
                                        class="mt-n28 mx-16"
                                        color="primary"
                                        text-color="white">
                                    Alter
                                    <v-icon right>
                                        mdi-cake-variant
                                    </v-icon>
                                </v-chip>
                            </div>
                        </v-card>
                    </v-col>

                    <!-- Start von Toolbox und Untermenüs-->
                    <v-col cols="12" align-self="stretch" color="secondary" dark>
                        <v-card class="mt-n12 mx-auto"
                                elevation="15"
                                height="1000"
                                dark

                        >
                            <v-toolbar class="toolbar">



                                <v-tabs dark
                                        background-color="primary"
                                        grow>

                                    <!--Beschriftung der Tabs -->
                                    <v-tab id="meineinfos">
                                        Meine Infos
                                        </v-badge>
                                    </v-tab>
                                    <v-tab>
                                        <v-badge
                                                color="green"
                                                icon="1">
                                            Meine Fächer
                                        </v-badge>
                                    </v-tab>
                                    <v-tab>
                                        <v-badge
                                                color="red"
                                                icon="4">
                                            Meine Gruppen
                                        </v-badge>
                                    </v-tab>

                                    <!--Content Meine Infos -->
                                    <v-tab-item dark="true">
                                        <v-card dark tile >
                                                <v-card-title>
                                                    Persönliches
                                                </v-card-title>
                                            <v-btn @click="saveinfo" float="right"> Bearbeiten</v-btn>
                                            <v-card-text>Geburtstag:</v-card-text>
                                            <v-text-field
                                                    v-model="geburtstag"
                                                    label="Geburtstag"
                                                    required
                                                    v-if="editMode == true"
                                            > </v-text-field>
                                            <v-text-field
                                                    v-model="geburtstag"
                                                    label="Geburtstag"
                                                    required
                                                    disabled
                                                    v-else
                                            > </v-text-field>


                                            <v-card-text>Geschlecht:</v-card-text>
                                            <v-text-field
                                                    v-model="geschlecht"
                                                    label="Geschlecht"
                                                    required
                                                    v-if="editMode == true"
                                            > </v-text-field>
                                            <v-text-field
                                                    v-model="geschlecht"
                                                    label="Geschlecht"
                                                    required
                                                    disabled
                                                    v-else
                                            > </v-text-field>



                                            <v-card-text>
                                                Studiengang:
                                            </v-card-text>
                                            <v-select
                                                    :items="studiengangsnamen"
                                                    label="Studiengang auswählen"
                                                    dense
                                                    outlined
                                                    required
                                                    v-model="aktuellerStudiengang"
                                                    v-if="editMode == true"
                                            ></v-select>
                                            <v-text-field
                                                    v-model="aktuellerStudiengang"
                                                    label="Studiengang"
                                                    required
                                                    disabled
                                                    v-else
                                            > </v-text-field>



                                            <v-card-text>Eingeschriebenes Semester:</v-card-text>
                                            <v-text-field
                                                    for="semester"
                                                    v-model="semester"
                                                    label="Semester"
                                                    required
                                                    v-if="editMode == true"
                                            > </v-text-field>
                                            <v-text-field
                                                    for="semester"
                                                    v-model="semester"
                                                    label="Semester"
                                                    required
                                                    disabled
                                                    v-else
                                            > </v-text-field>



                                            <v-card-text>Meine Stärken:</v-card-text>
                                            <v-text-field
                                                    v-model="staerken"
                                                    label="Stärken"
                                                    required
                                                    v-if="editMode == true"
                                            > </v-text-field>
                                            <v-text-field
                                                    v-model="staerken"
                                                    label="Stärken"
                                                    required
                                                    disabled
                                                    v-else
                                            > </v-text-field>



                                            <v-card-text>Meine Schwächen:</v-card-text>
                                            <v-text-field
                                                    v-model="schwaechen"
                                                    label="Schwaechen"
                                                    required
                                                    v-if="editMode == true"
                                            > </v-text-field>
                                            <v-text-field
                                                    v-model="schwaechen"
                                                    label="Schwächen"
                                                    required
                                                    disabled
                                                    v-else
                                            > </v-text-field>

                                            <v-btn v-if="editMode == true" @click="addInfo" > Speichern</v-btn>
                                        </v-card>


                                    </v-tab-item>

                                    <!--Content Meine Fächer-->
                                    <v-tab-item  background-color="secondary">

                                        <v-card
                                                dark

                                                tile>
                                            <v-card-title> Frag diese Personen nach Rat</v-card-title>
                                            <v-card-title class="mx-5"> <v-card-title>
                                                <v-sheet
                                                        color="light-blue accent-1"
                                                        elevation="1"
                                                        height="100"
                                                        width="500"
                                                        class="mx-4 mb-4"
                                                        rounded
                                                > <v-avatar

                                                        class="mr-16 mt-3 float-right    "
                                                        size="80">
                                                    <img
                                                            src="https://randomuser.me/api/portraits/lego/6.jpg"
                                                            alt="Juan">
                                                </v-avatar>
                                                    <v-card-title class="">
                                                        Sprich mit Experten über Fach 1
                                                    </v-card-title>


                                                    <v-btn
                                                            small
                                                            color="success"
                                                            dark
                                                            class=" ma-1"
                                                    >
                                                        Zur Gruppe
                                                    </v-btn>


                                                </v-sheet>
                                                <v-sheet
                                                        color="light-blue accent-1"
                                                        elevation="1"
                                                        height="100"
                                                        width="500"
                                                        class="mx-4 mb-4"
                                                        rounded
                                                > <v-avatar

                                                        class="mr-16 mt-3 float-right    "
                                                        size="80">
                                                    <img
                                                            src="https://randomuser.me/api/portraits/lego/6.jpg"
                                                            alt="Juan">
                                                </v-avatar>
                                                    <v-card-title class="">
                                                        Sprich mit Experten über Fach 2
                                                    </v-card-title>


                                                    <v-btn
                                                            small
                                                            color="success"
                                                            dark
                                                            class=" ma-1"
                                                    >
                                                        Zur Gruppe
                                                    </v-btn>


                                                </v-sheet>
                                                <v-sheet
                                                        color="light-blue accent-1"
                                                        elevation="1"
                                                        height="100"
                                                        width="500"
                                                        class="mx-4 mb-4"
                                                        rounded
                                                > <v-avatar

                                                        class="mr-16 mt-3 float-right    "
                                                        size="80">
                                                    <img
                                                            src="https://randomuser.me/api/portraits/lego/6.jpg"
                                                            alt="Juan">
                                                </v-avatar>
                                                    <v-card-title class="">
                                                        Sprich mit Experten über Fach 3
                                                    </v-card-title>


                                                    <v-btn
                                                            small
                                                            color="success"
                                                            dark
                                                            class=" ma-1"
                                                    >
                                                        Zur Gruppe
                                                    </v-btn>


                                                </v-sheet>


                                        </v-card>

                                        <v-card
                                                dark
                                                tile>
                                            <v-card-title > Hilf diesen Personen auf die Sprünge</v-card-title>
                                            <v-card-title class="mx-5">  <v-card-title>
                                                <v-sheet
                                                        color="deep-orange lighten-1"
                                                        elevation="1"
                                                        height="100"
                                                        width="500"
                                                        class="mx-4 mb-4"
                                                        rounded
                                                >
                                                    <v-avatar

                                                            class="mr-16 mt-3 float-right    "
                                                            size="80">
                                                        <img
                                                                src="https://randomuser.me/api/portraits/lego/6.jpg"
                                                                alt="Juan">
                                                    </v-avatar>
                                                    <v-card-title class="">
                                                        Hilf Personen in Fach 1
                                                    </v-card-title>


                                                    <v-btn
                                                            small
                                                            color="success"
                                                            dark
                                                            class=" ma-1"
                                                    >
                                                        Zur Gruppe
                                                    </v-btn>
                                                </v-sheet>
                                                <v-sheet
                                                        color="deep-orange lighten-1"
                                                        elevation="1"
                                                        height="100"
                                                        width="500"
                                                        class="mx-4 mb-4"
                                                        rounded
                                                >
                                                    <v-avatar

                                                            class="mr-16 mt-3 float-right    "
                                                            size="80">
                                                        <img
                                                                src="https://randomuser.me/api/portraits/lego/6.jpg"
                                                                alt="Juan">
                                                    </v-avatar>
                                                    <v-card-title class="">
                                                        Hilf Personen in Fach 2
                                                    </v-card-title>


                                                    <v-btn
                                                            small
                                                            color="success"
                                                            dark
                                                            class=" ma-1"
                                                    >
                                                        Zur Gruppe
                                                    </v-btn>
                                                </v-sheet>
                                                <v-sheet
                                                        color="deep-orange lighten-1"
                                                        elevation="1"
                                                        height="100"
                                                        width="500"
                                                        class="mx-4 mb-4"
                                                        rounded
                                                >
                                                    <v-avatar

                                                            class="mr-16 mt-3 float-right    "
                                                            size="80">
                                                        <img
                                                                src="https://randomuser.me/api/portraits/lego/6.jpg"
                                                                alt="Juan">
                                                    </v-avatar>
                                                    <v-card-title class="">
                                                        Hilf Personen in Fach 3
                                                    </v-card-title>


                                                    <v-btn
                                                            small
                                                            color="success"
                                                            dark
                                                            class=" ma-1"
                                                    >
                                                        Zur Gruppe
                                                    </v-btn>
                                                </v-sheet>
                                        </v-card>
                                    </v-tab-item>
                                    <v-tab-item>

                                        <!-- Content Meine Gruppen-->
                                        <v-card dark
                                                tile>
                                            <v-card-title> Deine Gruppen </v-card-title>

                                            <v-main>
                                                <v-container  >
                                                    <v-row align-content="center" dense >
                                                        <v-col cols="4" v-for="gruppe in gruppen">
                                                            <v-card
                                                                    class="mx-auto"
                                                                    max-width="860"
                                                                    outlined
                                                            >
                                                                <v-list-item three-line>
                                                                    <v-list-item-content>
                                                                        <v-list-item-title class="text-h5 mb-1">
                                                                            {{gruppe.gruppenname}}
                                                                        </v-list-item-title>
                                                                        <v-list-item-subtitle>Mitgliederanzahl: {{gruppe.teilnehmeranzahl}}</v-list-item-subtitle>
                                                                    </v-list-item-content>
                                                                </v-list-item>

                                                                <v-card-actions>
                                                                    <v-btn
                                                                            outlined
                                                                            text
                                                                    >
                                                                        Ansehen
                                                                    </v-btn>
                                                                    <v-btn
                                                                            outlined
                                                                            text
                                                                    >
                                                                        Beitreten
                                                                    </v-btn>
                                                                </v-card-actions>
                                                            </v-card>
                                                        </v-col>



                                                    </v-row>
                                                </v-container>
                                            </v-main>
                                            <!-- Chatportal Links-->
                                            <v-card-title> Chatportal</v-card-title>
                                            <v-card-text>Hier geht es in unser Chatportal</v-card-text>
                                            <v-btn
                                                    color="#286BF9"
                                                    class="mt-2 mx-5 mb-5"
                                                    @click="overlay = !overlay">
                                                Finde neue Gruppen
                                            </v-btn>
                                            <v-btn
                                                    color="#286BF9"
                                                    class="mt-2 mx-5 mb-5"
                                                    @click="openChat()">

                                                Meine Chats
                                            </v-btn>
                                            </v-btn>
                                            <v-btn
                                                    color="#286BF9"
                                                    class="mt-2 mx-5 mb-5"
                                                    @click="overlay = !overlay">
                                                Meine Chatanfragen
                                            </v-btn>
                                        </v-card>
                                    </v-tab-item>
                                </v-tabs>
                            </v-toolbar>
                    </v-col>
                </v-row>
            </v-container>
        </v-main>

        <!-- Footer-->
        <v-footer padless>
            <v-col class="text-center"
                   cols="16">
                {{ new Date().getFullYear() }} — <strong>Gruppe A4</strong>
            </v-col>
        </v-footer>
    </v-app>
</div>



<script>

    var app = new Vue({
        el: '#app',
        vuetify: new Vuetify(),

        data: {
            editMode:false,
            fusch:"",
            navdraw: false,
            studiengaenge:[],
            rules: [
                value => !value || value.size < 4000000 || 'Profilbild sollte kleiner als 4MB sein!',
            ],
            items: [
                { title: 'Home', icon: 'mdi-home-variant-outline', url:   "http://localhost:8080/home"},
                { title: 'Mein Profil', icon: 'mdi-account-outline', url: "http://localhost:8080/Profil"},
                { title: 'Gruppen', icon: 'mdi-account-group-outline', url: "http://localhost:8080/Gruppen"},
            ],
            student: null,
            profilepic: "",
            chaturl:"http://localhost:8080/chat",
            aktuellerStudiengang:"",
            geburtstag: "",
            geschlecht: "",
            semester: "",
            staerken: "",
            schwaechen: "",
            gruppen:[],
            requestOptions: {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: {}
            },
            imgRequestOptions: {
                method: "POST",
                headers: {"Content-Type": "multipart/form-data"},

            }


        },
        methods: {
            setGruppen(data){
                console.log("Gruppen:");
                console.log(data);
                this.gruppen = data.gruppen;
            },
            fetchGruppen(){
                fetch("Gruppen/getGruppen",  this.requestOptions)
                    .then(rep => rep.json())
                    .then(data => (
                        this.setGruppen(data)
                    ));
            },
            getStudent(data) {
                this.student = data;
                console.log(this.student);
            },
            getStudiengaenge(data) {
                this.studiengaenge = data;
                // console.log(this.studiengaenge);
                let test = this.studiengangsnamen;

            },
            openUrl(url, method) {
                window.open(url, method);
            },
            openChat() {
                this.initSession();
                sessionStorage.setItem("svorname", this.fusch);
                this.openUrl(this.chaturl, '');
            },
            initSession() {
                sessionStorage.setItem("id", "");
                sessionStorage.setItem("svorname", "");
                sessionStorage.setItem("snachname", "");
                sessionStorage.setItem("sbilderpfad", "");
            },
            onSubmit() {
                fetch("/geburtstag").then(rep => rep.json().then(data => this.geburtstag(data)));
                console.log(this.geburtstag);
                fetch("/geschlecht").then(rep => rep.json().then(data => this.geschlecht(data)));
                console.log(this.geschlecht);
                fetch("/semester").then(rep => rep.json().then(data => this.semester(data)));
                console.log(this.semester);
                fetch("/stärken").then(rep => rep.json().then(data => this.staerken(data)));
                console.log(this.staerken);
                fetch("/schwächen").then(rep => rep.json().then(data => this.schwaechen(data)));
                console.log(this.schwaechen);
            },
            onChange(event){
                const files = event.target.files
                let pic = files[0].name;
                console.log(pic)
                if(pic.lastIndexOf(".")<=0){
                    return alert("Bitte gültiges Bild hinzufügen")
                } this.profilepic = files[0]
            },
            onChanged() {
                console.log("New picture loaded");
                console.log(this.$refs.imginput)
                if (this.$refs.imginput.file) {
                    this.profilepic = this.$refs.imginput.file;
                } else {
                    console.log("Old browser. No support for Filereader API");
                }
            },
            onRemove() {
                this.image = '';
            },
            addInfo(info){
                let data = {
                    "geburtstag": this.geburtstag,
                    "geschlecht": this.geschlecht,
                    "aktuellerStudiengang": this.aktuellerStudiengang,
                    "semester": this.semester,
                    "staerken": this.staerken,
                    "schwaechen": this.schwaechen
                }


                fetch("/upload", data)
                    .then((res) => res.text())
                    .then(data => (
                        console.log("Supi")
                    ));
                // console.log("Bild" + this.profilepic)
                // const formData = new FormData();
                //         formData.append('file', this.profilepic)
                //     fetch("/upload", formData)
                //         .then((res) => res.text())
                //         .then(data => (
                //             console.log("Supi")
                //         ));
                //     console.log("post send")
                // this.info.push(info)

            },
            saveinfo(){
                this.editMode = !this.editMode;
            },
        },
        computed:{
            studiengangsnamen(){
                // console.log()
                let namen = [];
                if(this.studiengaenge.Studiengang !== undefined){
                    this.studiengaenge.Studiengang.forEach(function(einArrayElement) {
                        namen.push(einArrayElement.stName);
                    });
                }
                return namen;
            }
        },

        created() {
            this.fetchGruppen();
            fetch("Profil/meineInfos/1")
                .then(rep => rep.json())
                .then(data => (
                    this.getStudent(data)
                ));

            fetch("/studiengaenge").then(rep => rep.json().then(data => this.getStudiengaenge(data)));

        },
    })
</script>


</body>
</html>
