<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>

    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">


    <title>HelpStudent</title>
    <!--  <link th:href="@{/styles/css/main.css}" rel="stylesheet">-->
    <!--  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">-->





</head>
<body >

<div id="app" >
    <v-app id="inspire"
    >
        <v-system-bar app
                      height="60"
        >
            <v-tooltip v-if="!$vuetify.theme.dark" bottom>
                <template v-slot:activator="{ on }">
                    <v-btn v-on="on" color="info" small fab @click="darkMode">
                        <v-icon class="mr-1">mdi-moon-waxing-crescent</v-icon>
                    </v-btn>
                </template>
                <span>Dark Mode On</span>
            </v-tooltip>

            <v-tooltip v-else bottom>
                <template v-slot:activator="{ on }">
                    <v-btn v-on="on" color="info" small fab @click="darkMode">
                        <v-icon color="yellow">mdi-white-balance-sunny</v-icon>
                    </v-btn>
                </template>
                <span>Dark Mode Off</span>
            </v-tooltip>
            <v-spacer></v-spacer>
            <v-btn
                    color="error"
                    elevation="4"
                    rounded
                    @click="closeWindow()"
            >beenden</v-btn>
        </v-system-bar>

        <v-app-bar
                app
                clipped-right
                flat
                height="72"
        >

            <v-spacer></v-spacer>

            <v-responsive max-width="100">
                <v-text-field
                        dense
                        flat
                        hide-details
                        rounded
                        solo-inverted
                ></v-text-field>
            </v-responsive>
        </v-app-bar>

        <v-main>
            <div id="app">
                    <v-app id="HSHL" :style="backgroundImage">
                        <v-card
                                v-for="n in 60"
                                class="mx-auto"
                                color="#3b00db"
                                dark
                                clipped-left
                        >
                            <v-card-title >
                                <v-list-item-avatar color="grey darken-3">
                                    <v-img
                                            class="elevation-6"
                                            alt=""
                                            src="https://avataaars.io/?avatarStyle=Transparent&topType=ShortHairShortCurly&accessoriesType=Prescription02&hairColor=Black&facialHairType=Blank&clotheType=Hoodie&clotheColor=White&eyeType=Default&eyebrowType=DefaultNatural&mouthType=Default&skinColor=Light"
                                    ></v-img>
                                </v-list-item-avatar>

                                <v-list-item-content>
                                    <v-list-item-title>{{item.username}}</v-list-item-title>
                                </v-list-item-content>
                            </v-card-title>

                            <v-card-text class="text-h5 font-weight-bold">
                                {{item.inhalt}}
                            </v-card-text>
                        </v-card>
                    </v-app>

            </div>

        </v-main>

        <v-footer
                app

                height="72"
                inset
        >
            <v-text-field
                    v-model="messageInput"
                    background-color="grey lighten-1"
                    dense
                    flat
                    hide-details
                    rounded
                    solo
            ></v-text-field>

            <v-btn
                    class="mx-2"
                    fab
                    dark
                    small
                    color="primary"
                    @click="sendMessage()"
            >
                <v-icon dark>
                    mdi-send
                </v-icon>
            </v-btn>
        </v-footer>
    </v-app>
</div>



<script>
    var app = new Vue({
        el: '#app',
        vuetify:
            new Vuetify({
            theme: {
                themes: {
                    light: {
                    },
                    dark: {
                    }
                }
            }
        }),
        data: {
            drawer: null,
            username:null,
            messageInput:null,
            receivedMessage:null,
            messages:[],

        },
        methods:{
            darkMode() {
                this.$vuetify.theme.dark = !this.$vuetify.theme.dark;
            },
            closeWindow(){
                window.close();
            },
            connect() {
                //todo im html code muss noch ein v-model="username" rein
                console.log("außerhalbv")
                console.log(this.username)
                if(this.username != null) {
                    console.log("innerhalb")
                    var socket = new SockJS('/ws');
                    stompClient = Stomp.over(socket);

                    stompClient.connect({}, this.onConnected, this.onError);
                }
            },


            onConnected() {
                // Subscribe to the Public Topic
                stompClient.subscribe('/topic/public', this.onMessageReceived);

                // Tell your username to the server
                stompClient.send("/app/chat.addUser",
                    {},
                    JSON.stringify({sender: this.username, type: 'JOIN'})
                )

            },

            onError(error) {
                //todo das hier noch so anpassen wie du willst
                connectingElement.textContent = 'Could not connect to WebSocket server. Please refresh this page to try again!';
                connectingElement.style.color = 'red';
            },


             sendMessage() {
                let messageContent = this.messageInput.trim();
                if(messageContent !== "" && stompClient) {
                    let chatMessage = {
                        sender: this.username,
                        content: messageContent,
                        type: 'CHAT'
                    };
                    stompClient.send("/app/chat.sendMessage", {}, JSON.stringify(chatMessage));
                    this.messageInput = "";
                }
            },

             onMessageReceived(payload) {
                //todo @jannik müssten wir nochmal zusammen drüber schauen



                var message = JSON.parse(payload.body);

                console.log(message)
                console.log("test")

                this.messages.push({username: message.sender, inhalt: message.content});


                // var messageElement = document.createElement('li');
                //
                // if(message.type === 'JOIN') {
                //     messageElement.classList.add('event-message');
                //     message.content = message.sender + ' joined!';
                // } else if (message.type === 'LEAVE') {
                //     messageElement.classList.add('event-message');
                //     message.content = message.sender + ' left!';
                // } else {
                //     messageElement.classList.add('chat-message');
                //
                //     var avatarElement = document.createElement('i');
                //     var avatarText = document.createTextNode(message.sender[0]);
                //     avatarElement.appendChild(avatarText);
                //     avatarElement.style['background-color'] = getAvatarColor(message.sender);
                //
                //     messageElement.appendChild(avatarElement);
                //
                //     var usernameElement = document.createElement('span');
                //     var usernameText = document.createTextNode(message.sender);
                //     usernameElement.appendChild(usernameText);
                //     messageElement.appendChild(usernameElement);
                // }
                //
                // var textElement = document.createElement('p');
                // var messageText = document.createTextNode(message.content);
                // textElement.appendChild(messageText);
                //
                // messageElement.appendChild(textElement);
                //
                // messageArea.appendChild(messageElement);
                // messageArea.scrollTop = messageArea.scrollHeight;
            },
        },
        created(){

            this.username = sessionStorage.getItem("svorname");
            this.connect();
        },

        computed: {
            backgroundImage() {
                if (this.$vuetify.theme.dark) {
                    return {
                        "background-image": "url('/bg.png')",
                        "background-position": "center",
                        "background-repeat": "no-repeat",
                        "background-attachment": "fixed",
                    }
                }

                if (!this.$vuetify.theme.light) {
                    return {
                        "background-image": "url('/bg1.png')",
                        "background-position": "center",
                        "background-repeat": "no-repeat",
                        "background-attachment": "fixed",
                    }
                }
            }
        }
    })
</script>
</body>

<style>
</style>


</html>